<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:hierarquia="urn:hierarquia" xmlns:tipo="urn:tipo"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:template match="//hierarquia:cena" mode="validate-references">
    <xsl:apply-templates select="hierarquia:refere | hierarquia:adereco" mode="validate-references"
    />
  </xsl:template>

  <xsl:template match="hierarquia:fala" mode="validate-references">
    <p>Teste1:<xsl:value-of select="key('ref-personagem', @ref-personagem)"/></p>
    <xsl:if test="name(key('ref-personagem', @ref-personagem)) = 'hierarquia:fala'">
      <xsl:message terminate="no"> Valor de quantidade não definido na linha número <xsl:value-of
          select="position()"/>
      </xsl:message>
    </xsl:if>
    <xsl:apply-templates select="hierarquia:refere | hierarquia:adereco" mode="validate-references"
    />
  </xsl:template>

  <xsl:template match="hierarquia:refere" mode="validate-references">
    <p>Teste2:<xsl:value-of select="name(key('ref-personagem', @ref-personagem))"/>
      <xsl:value-of
        select="not(name(key('ref-personagem', @ref-personagem)) = 'tipo:personagem') and not(name(key('ref-personagem', @ref-personagem)) = 'personagem')"
      /></p>
    <xsl:if
      test="not(name(key('ref-personagem', @ref-personagem)) = 'tipo:personagem') and not(name(key('ref-personagem', @ref-personagem)) = 'personagem')">
      <xsl:message terminate="no"> O ID de referência do elemento refere com o valor <xsl:value-of
          select="@ref-personagem"/> não corresponde a uma personagem! </xsl:message>
    </xsl:if>
  </xsl:template>

  <xsl:template match="hierarquia:adereco" mode="validate-references">
    <p>Teste3:<xsl:value-of select="name(key('ref-adereco', adereco))"/></p>
    <xsl:if test="not(name(key('ref-adereco', @ref-adereco)) = 'tipo:adereco') and not(name(key('ref-adereco', @ref-adereco)) = 'adereco')">
      <xsl:message terminate="no"> O ID de referência do elemento adereco com o valor <xsl:value-of
        select="@ref-adereco"/> não corresponde a uma personagem! </xsl:message>
    </xsl:if>
  </xsl:template>

</xsl:stylesheet>
